<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>master</title>
    <link href="favicon.ico" rel="icon" type="image/ico" />
    <script type="text/javascript" src="clock.js"></script>
    <script type="text/javascript" src="player.js"></script>
    <script type="text/javascript" src="syncer.js"></script>
    <script type="text/javascript" src="client.js"></script>
    <script>
      /*
       * when you click on header element:
       *  socket and player will be instantiated.
       *
       *  when socket connects syncer will start to communicate with server for
       *  a clock synchronization and if it succeeds it will bind socket message
       *  event to a player.
       *
       *  player and streamer on server will continue to communicate.
       */
      window.addEventListener('load', function() {
        var did = false;
        var header = document.getElementById("header");
        var start = false;
        header.addEventListener('click', function() {
          if (did) {return;}
          var socket = new WebSocket("ws://lieutier.me:8080");
          var player = new Player(myClock.clock);
          header.innerHTML = "syncing...";
          socket.onopen = function() {
            new Syncer(socket, function() {
              header.innerHTML = "client synced!";
              did = true;
              window.setTimeout(function(){
                start = true;
              },1000);
              new Client(socket, player);
              window.addEventListener("devicemotion", function sync(event) {
                var r =
                  event.acceleration.x*event.acceleration.x +
                  event.acceleration.y*event.acceleration.y +
                  event.acceleration.z*event.acceleration.z;
                if (start && r > 0.6) {
                  shout(myClock.clock());
                  window.removeEventListener("devicemotion", sync);
                }
              });
            });
          };
        });
      });

    </script>
  </head>
  <body>
    <h1 id="header">client. click here to start.</h1>
  </body>
</html>